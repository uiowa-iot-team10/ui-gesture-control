<!DOCTYPE html>
<html>
  <head>
    <title>IoT Team 10</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="./style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  </head>
  <body>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyD-1MU1jlQAtUxHzIMSHbRPFFLDZ7uzI8M",
            authDomain: "iot-team10.firebaseapp.com",
            projectId: "iot-team10",
            storageBucket: "iot-team10.appspot.com",
            messagingSenderId: "196021370184",
            appId: "1:196021370184:web:3506364930c0c74fa9477d"
        };
        firebase.initializeApp(firebaseConfig);

        firebase.auth().onAuthStateChanged(function(user) {
            if (user == null) {
                window.location.replace("/login");
            } else if (user && !user.emailVerified) {
                // TO-DO: Put an alert to inform user to verify their account
                window.confirm("VERIFY YOUR EMAIL!!!!");
                sign_out();
                window.location.replace("/login");
            }
            else {
                $("#content h2").text("Welcome, " + user.displayName);
                make_visible();
            }
        });

        var game_array = null;
        var index = 0;
        focus;
        function sign_out() {
            firebase.auth().signOut().then(() => {
                window.location.assign("/login");
            }).catch((error) => {
                alert("[ERROR] Could not sign out: " + error.message);
            });
        }
        
        function make_visible() {
            $("#content").removeAttr('hidden');
            document.onkeydown = interpKeydown;
            game_array = document.getElementById("game-nav").children;
            for (i = 0; i < game_array.length; i++)
            {
              game_array[i].setAttribute('tabindex', '0');
            }
            var index = 0;
            focus;
            game_array[index].focus();
        }
    </script>
    <div id="content" hidden>      
      <div id = "screen">
        <header>
          <section id = "settings">
            <span id="icon">
              <i id = "fa" class="fa fa-bar-chart fa-lg"></i>
            </span>
            <span id="icon">
              <i id = "fa" class="fa fa-user-o fa-lg"></i>
            </span>
          </section>
        </header>
        <div id = "container">
          <div id = "game-nav">
            <div id = "game1" class = "game"></div>
            <div id = "game2" class = "game"></div>
            <div id = "game3" class = "game"></div>
            <div id = "game4" class = "game"></div>
          </div>
        </div>

        <section>
          <p id = "status" class = "notconnected">Server: Not Connected!</p>
        </section>
        <button type="button" style="max-width: 15%;" onclick="sign_out()" class="btn btn-primary btn-block"> Sign Out  </button>

        <section id = "info">
          <span id = "sub-title">
            Latest Games Played
          </span>
        </section>
        <section id = "game-tweets">
          <a class="twitter-timeline" data-width="1200" data-height="400" data-theme="dark" href="https://twitter.com/Wendys?ref_src=twsrc%5Etfw">Tweets by Wendys</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </section>
      </div>
    </div>


    <script src="/socket.io/socket.io.js"></script>

    <script>
      function interpKeydown(e)
      {
        if (e.keyCode == '39') // if right arrow, index + 1
        {
            setNewFocus('RIGHT');
        }
        if (e.keyCode == '37') // else if left arrow, index - 1
        {
            setNewFocus('LEFT');
        }
      }

      function setNewFocus(direction)
      {
          if (direction == 'RIGHT')
          {
            if (index < game_array.length) {
              index = index + 1;
              game_array[index].focus();
            }
          }
          else if (direction == 'LEFT')
          {
            if (index > 0) {
              index = index - 1;
              game_array[index].focus();
            }
          }
          else if(direction == 0)
          {
            var status = document.getElementById(game_array[index]);
            status.style.backgroundColor = 'yellow';
          }
      }

      var socket = io.connect();
      socket.on('connection', function(data){
          var status = document.getElementById("status");
          status.setAttribute("class", "connected");
          status.innerHTML = "Server: Connected!";
      });

      socket.on('disconnect', function(data){
          var status = document.getElementById("status");
          status.setAttribute("class", "notconnected");
          status.innerHTML = "Server: Not Connected!";
      });

      socket.on('gesture', function(data){
          console.log(data);
          setNewFocus(data);
      });
    </script>
  </body>
</html>
